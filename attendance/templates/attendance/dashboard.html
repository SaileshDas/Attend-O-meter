{# attendance/templates/attendance/dashboard.html #}

{% extends 'base.html' %}

{% block title %}Dashboard - Attendance Tracker{% endblock %}

{% block content %}
<h2 class="mb-4">Welcome to your Dashboard, {{ user.username }}!</h2>

{% if current_session %}
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h3 class="card-title">Current Academic Session: {{ current_session.name }}</h3>
            <p class="card-text">
                <a href="{% url 'update_academic_session' pk=current_session.pk %}" class="btn btn-sm btn-outline-secondary">Edit Session</a>
                <a href="{% url 'academic_session_list' %}" class="btn btn-sm btn-outline-info ms-2">All Sessions</a>
            </p>
        </div>
    </div>

    <div class="row">
        {# Subjects Card #}
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-light">
                    <h4 class="mb-0">Your Subjects</h4>
                </div>
                <div class="card-body">
                    <a href="{% url 'add_subject' session_pk=current_session.pk %}" class="btn btn-primary btn-sm mb-3">Add New Subject</a>
                    {% if subjects %}
                        <ul class="list-group list-group-flush">
                            {% for subject in subjects %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <a href="{% url 'subject_detail' pk=subject.pk %}" class="fw-bold text-decoration-none">{{ subject.name }} ({{ subject.code|default:"N/A" }})</a>
                                        <br>
                                        <small class="text-muted">Min. Attendance: {{ subject.minimum_attendance_percentage|floatformat:"0" }}%</small>
                                    </div>
                                    <div>
                                        <a href="{% url 'add_attendance' subject_pk=subject.pk %}" class="btn btn-success btn-sm me-2">Add Attendance</a>
                                        <a href="{% url 'update_subject' pk=subject.pk %}" class="btn btn-outline-primary btn-sm">Edit</a>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">No subjects added yet for this session. <a href="{% url 'add_subject' session_pk=current_session.pk %}">Add your first subject</a>.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        {# Upcoming Exams Card #}
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-light">
                    <h4 class="mb-0">Upcoming Exams</h4>
                </div>
                <div class="card-body">
                    <a href="{% url 'add_exam_date' session_pk=current_session.pk %}" class="btn btn-primary btn-sm mb-3">Add New Exam Date</a>
                    {% if exam_dates %}
                        <ul class="list-group list-group-flush">
                            {% for exam in exam_dates %}
                                <li class="list-group-item">
                                    <span class="fw-bold">{{ exam.exam_type }}:</span> {{ exam.start_date|date:"F d, Y" }}
                                    {% if exam.end_date %}- {{ exam.end_date|date:"F d, Y" }}{% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">No exam dates added yet for this session. <a href="{% url 'add_exam_date' session_pk=current_session.pk %}">Add an exam date</a>.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        {# Holidays Management Card #}
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-light">
                    <h4 class="mb-0">Holidays Management</h4>
                </div>
                <div class="card-body">
                    <p class="card-text text-muted">Add or manage holidays for academic sessions.</p>
                    <a href="{% url 'bulk_add_holidays' %}" class="btn btn-info btn-sm me-2">Add Multiple Holidays</a>
                    <a href="{% url 'admin:attendance_holiday_changelist' %}" class="btn btn-outline-secondary btn-sm">View/Edit in Admin</a>
                </div>
            </div>
        </div>

        {# Add any other cards/sections here #}

    </div> {# End of row #}

{% else %}
    <div class="alert alert-warning" role="alert">
        No current academic session found. Please <a href="{% url 'add_academic_session' %}" class="alert-link">add a new academic session</a> to get started.
    </div>
{% endif %}
{% endblock %}